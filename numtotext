-- Set safe execution parameters
set hive.execution.engine=tez;
set hive.vectorized.execution.enabled=true;
set hive.vectorized.execution.reduce.enabled=true;
set hive.tez.container.size=4096;
set tez.grouping.max-size=1073741824;
set hive.auto.convert.join=false;
set hive.exec.dynamic.partition.mode=nonstrict;
set hive.exec.stagingdir=/tmp/hive-staging;

-- Create table with debug-safe SELECT
create table dpdm_curated_epdn.tmps_entities_resolution_match_180M as
select 
    entity_id as match_entity_id,
    mod(row_number() over (order by entity_id), 180) as match_partition_bucket,
    match_name,
    match_address,
    match_state,
    country as match_country,
    postal_code as match_postal_code
from dpdm_curated_epdn.tmp_entities;
